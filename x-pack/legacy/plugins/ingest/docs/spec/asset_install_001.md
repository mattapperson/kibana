# Asset Install APIs

Asset instilation APIS will be JS/TS only as they are intended for use only by plugins within Kibana and not a user-facing system though there is the ability to expose this to a REST interface in the future should we decide that is needed.

## Asset types

The following asset types have support planned:

**ES Assets**

- Ingest pipelines -- Expected to be unchanged by users
- Index Templates -- Expected to be unchanged by users
- ILM Policies -- Expect user edits
- Rollup Jobs -- Expect user edits
- ML Jobs\*
- Data Frame Transforms\*

\* Indicates somehting might not be supported in inital release

## API

**installAssets()**
This method exposed by Ingest plugin will accept a config object with the following paramaters:

- \* source (The plugin installing the asset)
- package (if the asset is being installed as part of an EPM package, this can be notated here)

and an array of the following paramters. Please note the asterix denotes a required param

- \* asset (the JSON or Blob of the asset, for instance a dashboard JSON string)
- \* type (One of the above asset types as a string name)
- id (an ID that can be used to link the asset to something in the source plugin if needed. a unique ID will still be generated by Ingest)
- version (if the asset has a version, this can be notated here. If versions are provided, future versions will not overwrite current versions. When no version is supplied, future instilations WILL overwrite existing UNLESS Ingest detects that the asset was edited by the user, in this case the install will error)

The method will return an an object with the following fields:

- installed - An array of objects containing the ID used to install the asset, the ref ID if provided, and a success: bool and a reason?:string if success is false for a non-error reason
- upgraded - An array of objects containing the ID used, the Ref ID if provided, the previous version that was installed (if provided)
- errors - an array of objects containing the Ref id if provided, the index of the asset in the provided array, and the error

**removeAssets()**
This method exposed by Ingest plugin will accept a config object with the following paramaters:

- \* source (The plugin requesting the removal of the asset)
- package (if the asset is being removed as part of the removal of an EPM package, this can be notated here)

and an array of the following paramters. Please note the asterix denotes a required param

- \* asset ID (what was returned as part of the install method
  OR
- \* asset ref ID (what was provided as part of the install step
- version (regardless ofd the ID type... the version of the asset removal is requested for. If none is provided the only asset will be removed or if multiple ALL will be removed

The method will return an an object with the following fields:

- removed - An array of objects containing the ID provided and a success: bool and a reason?:string if success is false for a non-error reason
- errors - an array of objects containing the Ref id if provided, the index of the asset in the provided array, and the error
  Note: For removal, we will return as an error if the asset is needed by another package/source that was not part of the removal request.

## Under The Hood

The Ingest asset APIs will:

- track installed assets for latter removal, including a hash of the asset for comparing later if it was user edited
- prevent issues of removing a co-dependent asset
- ensure user edited assets are not overwritten
- install the assets, including re-try logic where needed
- Throw an error on asset install that is known to be out of order (e.g. Rollup jobs before templates are installed would throw)
- When passed a newer version of an asset, correctly upgrade the previos asset

The Ingest asset APIs will **NOT**:

- self-trigger upgrade or install of any assets, assets must be passed to Ingest plugin by Fleet or solutions.
- store a collection of assets installed or un-installed
- Install Visualizations, Dashboards, Saved Searches or Index Patterns as these are not needed by solutions.
